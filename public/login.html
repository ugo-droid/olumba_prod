<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Olumba - Secure Login</title>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script>tailwind.config = {theme: {extend: {colors: {primary: "#2171f2", "accent-1": "#22C55E", "accent-2": "#FF8C42", background: "#FFFFFF", "background-alt": "#F3F4F6", text: "#22223B", "footer-border": "#1E293B"}, fontFamily: {display: "Inter"}, borderRadius: {DEFAULT: "0.5rem", lg: "1rem", xl: "1.5rem", full: "9999px"}}}};</script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/js/config.js"></script>
<script src="/js/supabaseClient.js"></script>
</head>
<body class="bg-background font-display text-text">
<div class="flex flex-col min-h-screen">
<header class="w-full px-4 sm:px-6 lg:px-8">
<div class="container mx-auto flex items-center justify-between py-4 border-b border-footer-border">
<div class="flex items-center gap-3">
<img src="/assets/olumba-logo.png" alt="Olumba" class="h-10 w-auto" />
</div>
</div>
</header>
<main class="flex-grow flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 bg-background-alt">
<div class="w-full max-w-md space-y-8 bg-background p-10 rounded-xl shadow-lg">
<div>
<h2 class="mt-6 text-center text-3xl font-extrabold text-text">Welcome back</h2>
<p class="mt-2 text-center text-sm text-text opacity-70">Sign in to continue to your workspace</p>
</div>
<form id="loginForm" class="mt-8 space-y-6" method="POST">
<div id="errorMessage" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative" role="alert">
<span class="block sm:inline" id="errorText"></span>
</div>
<div id="mfaSection" class="hidden">
<div>
<label class="sr-only" for="mfa-code">MFA Code</label>
<input autocomplete="off" class="form-input appearance-none relative block w-full px-3 py-3 border border-footer-border placeholder-gray-500 text-text bg-background-alt rounded-lg focus:outline-none focus:ring-primary focus:border-primary focus:z-10 sm:text-sm" id="mfa-code" name="mfa_code" placeholder="Enter 6-digit code" type="text"/>
</div>
</div>
<div id="credentialsSection" class="rounded-md shadow-sm -space-y-px">
<div>
<label class="sr-only" for="email-address">Email address</label>
<input autocomplete="email" class="form-input appearance-none rounded-none relative block w-full px-3 py-3 border border-footer-border placeholder-gray-500 text-text bg-background-alt rounded-t-lg focus:outline-none focus:ring-primary focus:border-primary focus:z-10 sm:text-sm" id="email-address" name="email" placeholder="Email address" required="" type="email"/>
</div>
<div>
<label class="sr-only" for="password">Password</label>
<input autocomplete="current-password" class="form-input appearance-none rounded-none relative block w-full px-3 py-3 border border-footer-border placeholder-gray-500 text-text bg-background-alt rounded-b-lg focus:outline-none focus:ring-primary focus:border-primary focus:z-10 sm:text-sm" id="password" name="password" placeholder="Password" required="" type="password"/>
</div>
</div>
<div class="flex items-center justify-between">
<div class="flex items-center">
<input class="h-4 w-4 text-primary focus:ring-primary border-footer-border rounded bg-background-alt" id="remember-me" name="remember-me" type="checkbox"/>
<label class="ml-2 block text-sm text-text" for="remember-me">Remember me</label>
</div>
<div class="text-sm">
<a class="font-medium text-primary hover:text-blue-500" href="#">Forgot your password?</a>
</div>
</div>
<div>
<button class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary" type="submit">
<span id="loginButtonText">Log In</span>
<span id="loginSpinner" class="hidden ml-2">
<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
</svg>
</span>
</button>
</div>
</form>
<div class="text-center">
<p class="text-sm text-text opacity-70">
Don't have an account?
<a class="font-medium text-primary hover:text-blue-500" href="/register.html">Sign up</a>
</p>
</div>
<div class="border-t border-footer-border pt-6">
<p class="text-xs text-center text-text opacity-60">
Demo Credentials: admin@stellar.com / password123
</p>
</div>
</div>
</main>
</div>
<script src="/js/api.js"></script>
<script>
const loginForm = document.getElementById('loginForm');
const emailInput = document.getElementById('email-address');
const passwordInput = document.getElementById('password');
const mfaCodeInput = document.getElementById('mfa-code');
const errorMessage = document.getElementById('errorMessage');
const errorText = document.getElementById('errorText');
const loginButtonText = document.getElementById('loginButtonText');
const loginSpinner = document.getElementById('loginSpinner');
const credentialsSection = document.getElementById('credentialsSection');
const mfaSection = document.getElementById('mfaSection');

let mfaRequired = false;

// Check if already logged in
if (isAuthenticated()) {
    window.location.href = '/dashboard.html';
}

loginForm.addEventListener('submit', async function(event) {
    event.preventDefault();
    
    // Hide error
    errorMessage.classList.add('hidden');
    
    // Show loading
    loginButtonText.textContent = 'Logging in...';
    loginSpinner.classList.remove('hidden');
    
    try {
        const email = emailInput.value;
        const password = passwordInput.value;
        const mfaCode = mfaRequired ? mfaCodeInput.value : null;
        
        const response = await auth.login(email, password, mfaCode);
        
        if (response.mfa_required) {
            // Show MFA input
            mfaRequired = true;
            credentialsSection.classList.add('hidden');
            mfaSection.classList.remove('hidden');
            loginButtonText.textContent = 'Verify';
            loginSpinner.classList.add('hidden');
            mfaCodeInput.focus();
            return;
        }
        
        // Login successful
        window.location.href = '/dashboard.html';
        
    } catch (error) {
        errorText.textContent = error.message || 'Login failed. Please try again.';
        errorMessage.classList.remove('hidden');
        loginButtonText.textContent = 'Log In';
        loginSpinner.classList.add('hidden');
    }
});
</script>
</body>
</html>
