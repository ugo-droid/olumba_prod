<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clerk Diagnostic - Olumba</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">Clerk Diagnostic Tool</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Script Loading Status</h2>
            <div id="scriptStatus" class="space-y-2">
                <div>Loading...</div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Clerk SDK Status</h2>
            <div id="clerkStatus" class="space-y-2">
                <div>Loading...</div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Console Logs</h2>
            <div id="consoleLogs" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-sm max-h-64 overflow-y-auto">
                <div>Waiting for logs...</div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Actions</h2>
            <div class="space-x-4">
                <button id="testInit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Test Clerk Initialization
                </button>
                <button id="testAuth" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Test Authentication Check
                </button>
                <button id="clearLogs" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    Clear Logs
                </button>
            </div>
        </div>
    </div>

    <!-- Clerk SDK -->
    <script async crossorigin="anonymous" data-clerk-publishable-key="pk_test_ZXhjaXRlZC1ob3VuZC02NC5jbGVyay5hY2NvdW50cy5kZXYk" src="https://excited-hound-64.clerk.accounts.dev/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"></script>
    
    <!-- App Configuration -->
    <script src="/js/config.js"></script>
    <script src="/js/clerkClient.js"></script>

    <script>
        const logs = [];
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        // Capture console logs
        console.log = function(...args) {
            logs.push({ type: 'log', message: args.join(' '), time: new Date().toLocaleTimeString() });
            updateConsoleLogs();
            originalLog.apply(console, args);
        };

        console.error = function(...args) {
            logs.push({ type: 'error', message: args.join(' '), time: new Date().toLocaleTimeString() });
            updateConsoleLogs();
            originalError.apply(console, args);
        };

        console.warn = function(...args) {
            logs.push({ type: 'warn', message: args.join(' '), time: new Date().toLocaleTimeString() });
            updateConsoleLogs();
            originalWarn.apply(console, args);
        };

        function updateConsoleLogs() {
            const container = document.getElementById('consoleLogs');
            container.innerHTML = logs.slice(-20).map(log => 
                `<div class="mb-1">
                    <span class="text-gray-500">[${log.time}]</span>
                    <span class="text-${log.type === 'error' ? 'red' : log.type === 'warn' ? 'yellow' : 'green'}-400">
                        ${log.type.toUpperCase()}:
                    </span>
                    <span>${log.message}</span>
                </div>`
            ).join('');
            container.scrollTop = container.scrollHeight;
        }

        function updateScriptStatus() {
            const container = document.getElementById('scriptStatus');
            const status = [];
            
            status.push(`Config.js: ${window.APP_CONFIG ? '✅ Loaded' : '❌ Not loaded'}`);
            status.push(`ClerkClient.js: ${window.clerkAuth ? '✅ Loaded' : '❌ Not loaded'}`);
            status.push(`Clerk SDK: ${window.Clerk ? '✅ Loaded' : '❌ Not loaded'}`);
            status.push(`Publishable Key: ${window.CLERK_PUBLISHABLE_KEY ? '✅ Set' : '❌ Not set'}`);
            
            container.innerHTML = status.map(s => `<div class="py-1">${s}</div>`).join('');
        }

        function updateClerkStatus() {
            const container = document.getElementById('clerkStatus');
            const status = [];
            
            if (window.Clerk) {
                status.push(`Clerk Object: ✅ Available`);
                status.push(`Version: ${window.Clerk.version || 'Unknown'}`);
                status.push(`Environment: ${window.Clerk.environment || 'Unknown'}`);
            } else {
                status.push(`Clerk Object: ❌ Not available`);
            }
            
            if (window.clerkAuth) {
                status.push(`ClerkAuth: ✅ Available`);
                status.push(`Functions: ${Object.keys(window.clerkAuth).join(', ')}`);
            } else {
                status.push(`ClerkAuth: ❌ Not available`);
            }
            
            container.innerHTML = status.map(s => `<div class="py-1">${s}</div>`).join('');
        }

        // Update status every second
        setInterval(() => {
            updateScriptStatus();
            updateClerkStatus();
        }, 1000);

        // Initial update
        updateScriptStatus();
        updateClerkStatus();

        // Button handlers
        document.getElementById('testInit').addEventListener('click', async () => {
            console.log('🧪 Testing Clerk initialization...');
            try {
                if (window.clerkAuth) {
                    await window.clerkAuth.initializeClerk();
                    console.log('✅ Clerk initialization successful');
                } else {
                    console.error('❌ ClerkAuth not available');
                }
            } catch (error) {
                console.error('❌ Clerk initialization failed:', error);
            }
        });

        document.getElementById('testAuth').addEventListener('click', () => {
            console.log('🧪 Testing authentication check...');
            try {
                if (window.clerkAuth) {
                    const isAuth = window.clerkAuth.isAuthenticated();
                    console.log(`🔍 Authentication status: ${isAuth}`);
                } else {
                    console.error('❌ ClerkAuth not available');
                }
            } catch (error) {
                console.error('❌ Authentication check failed:', error);
            }
        });

        document.getElementById('clearLogs').addEventListener('click', () => {
            logs.length = 0;
            updateConsoleLogs();
        });

        console.log('🚀 Diagnostic tool loaded');
    </script>
</body>
</html>
