<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clerk Simple Test - Olumba</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Clerk SDK -->
    <script async crossorigin="anonymous" data-clerk-publishable-key="pk_test_ZXhjaXRlZC1ob3VuZC02NC5jbGVyay5hY2NvdW50cy5kZXYk" src="https://excited-hound-64.clerk.accounts.dev/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"></script>
    
    <!-- Alternative CDN -->
    <script>
        // Fallback if the above doesn't work
        if (!window.Clerk) {
            console.log('Loading Clerk from CDN fallback...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/@clerk/clerk-js@latest/dist/clerk.browser.js';
            script.setAttribute('data-clerk-publishable-key', 'pk_test_ZXhjaXRlZC1ob3VuZC02NC5jbGVyay5hY2NvdW50cy5kZXYk');
            script.async = true;
            script.crossOrigin = 'anonymous';
            document.head.appendChild(script);
        }
    </script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">Clerk Simple Test</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Loading Status</h2>
            
            <div class="space-y-4">
                <div class="flex items-center">
                    <div id="sdkStatus" class="w-4 h-4 rounded-full bg-yellow-400 mr-3"></div>
                    <span id="sdkText">Checking Clerk SDK...</span>
                </div>
                
                <div class="flex items-center">
                    <div id="authStatus" class="w-4 h-4 rounded-full bg-yellow-400 mr-3"></div>
                    <span id="authText">Checking authentication...</span>
                </div>
                
                <div id="userInfo" class="hidden p-4 bg-gray-50 rounded">
                    <h3 class="font-semibold mb-2">User Information</h3>
                    <div id="userDetails"></div>
                </div>
                
                <div id="errorInfo" class="hidden p-4 bg-red-50 border border-red-200 rounded">
                    <h3 class="font-semibold mb-2 text-red-700">Error Details</h3>
                    <div id="errorDetails" class="text-red-600"></div>
                </div>
            </div>
            
            <div class="mt-6 text-center">
                <button id="refreshBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Refresh Test
                </button>
            </div>
        </div>
        
        <div class="mt-6 bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Console Logs</h2>
            <div id="consoleLogs" class="bg-gray-900 text-green-400 p-4 rounded text-sm font-mono h-64 overflow-y-auto">
                <!-- Console logs will appear here -->
            </div>
        </div>
    </div>

    <script>
        // Override console.log to capture logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addLog(message, type = 'log') {
            const logsContainer = document.getElementById('consoleLogs');
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.createElement('div');
            logElement.className = type === 'error' ? 'text-red-400' : type === 'warn' ? 'text-yellow-400' : 'text-green-400';
            logElement.textContent = `[${timestamp}] ${message}`;
            logsContainer.appendChild(logElement);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog(args.join(' '), 'warn');
        };
        
        function updateStatus(elementId, success, text) {
            const element = document.getElementById(elementId);
            const indicator = element.querySelector('div');
            const textElement = element.querySelector('span');
            
            indicator.className = success ? 'w-4 h-4 rounded-full bg-green-400 mr-3' : 'w-4 h-4 rounded-full bg-red-400 mr-3';
            textElement.textContent = text;
        }
        
        async function runTest() {
            console.log('Starting Clerk test...');
            
            // Clear previous results
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('errorInfo').classList.add('hidden');
            
            try {
                // Test 1: Check if Clerk SDK loaded
                console.log('Testing Clerk SDK availability...');
                if (typeof window.Clerk !== 'undefined') {
                    updateStatus('sdkStatus', true, 'Clerk SDK loaded successfully');
                    console.log('✅ Clerk SDK is available');
                } else {
                    updateStatus('sdkStatus', false, 'Clerk SDK not loaded');
                    console.error('❌ Clerk SDK is not available');
                    
                    // Show error details
                    document.getElementById('errorInfo').classList.remove('hidden');
                    document.getElementById('errorDetails').innerHTML = `
                        <p><strong>Issue:</strong> Clerk SDK not loaded</p>
                        <p><strong>Possible causes:</strong></p>
                        <ul class="list-disc list-inside mt-2">
                            <li>Network connectivity issues</li>
                            <li>Invalid publishable key</li>
                            <li>Script loading error</li>
                            <li>Content Security Policy blocking</li>
                        </ul>
                    `;
                    return;
                }
                
                // Test 2: Check authentication status
                console.log('Testing authentication status...');
                const isAuth = window.Clerk.user && window.Clerk.user.id;
                
                if (isAuth) {
                    updateStatus('authStatus', true, 'User is authenticated');
                    console.log('✅ User is authenticated');
                    
                    // Show user info
                    const user = window.Clerk.user;
                    document.getElementById('userInfo').classList.remove('hidden');
                    document.getElementById('userDetails').innerHTML = `
                        <p><strong>ID:</strong> ${user.id}</p>
                        <p><strong>Email:</strong> ${user.emailAddresses?.[0]?.emailAddress || 'N/A'}</p>
                        <p><strong>Name:</strong> ${user.fullName || 'N/A'}</p>
                        <p><strong>Created:</strong> ${user.createdAt ? new Date(user.createdAt).toLocaleString() : 'N/A'}</p>
                    `;
                } else {
                    updateStatus('authStatus', true, 'User is not authenticated (this is normal)');
                    console.log('ℹ️ User is not authenticated (this is normal for new users)');
                }
                
                // Test 3: Check session availability
                console.log('Testing session availability...');
                try {
                    const session = await window.Clerk.session;
                    if (session) {
                        console.log('✅ Session is available');
                        const token = await session.getToken();
                        if (token) {
                            console.log('✅ Auth token available');
                        } else {
                            console.log('ℹ️ No auth token (user not signed in)');
                        }
                    } else {
                        console.log('ℹ️ No session (user not signed in)');
                    }
                } catch (sessionError) {
                    console.warn('⚠️ Session test failed:', sessionError.message);
                }
                
                console.log('✅ Clerk test completed successfully!');
                
            } catch (error) {
                console.error('❌ Clerk test failed:', error);
                
                updateStatus('sdkStatus', false, 'Test failed');
                updateStatus('authStatus', false, 'Test failed');
                
                document.getElementById('errorInfo').classList.remove('hidden');
                document.getElementById('errorDetails').innerHTML = `
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p><strong>Type:</strong> ${error.name}</p>
                    <pre class="mt-2 text-xs overflow-auto">${error.stack}</pre>
                `;
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Page loaded, starting Clerk test...');
            
            // Wait a bit for Clerk to potentially load
            setTimeout(runTest, 1000);
            
            // Also try when window loads
            window.addEventListener('load', () => {
                setTimeout(runTest, 500);
            });
            
            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', () => {
                document.getElementById('consoleLogs').innerHTML = '';
                runTest();
            });
        });
        
        // Log any global errors
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
        });
    </script>
</body>
</html>
