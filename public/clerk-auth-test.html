<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clerk Auth Test - Olumba</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">Clerk Authentication Test</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Authentication Status</h2>
            <div id="authStatus" class="space-y-2">
                <div>Loading...</div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Clerk Instance Details</h2>
            <div id="clerkDetails" class="space-y-2">
                <div>Loading...</div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Actions</h2>
            <div class="space-x-4">
                <button id="checkAuth" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Check Authentication
                </button>
                <button id="getUser" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Get Current User
                </button>
                <button id="getToken" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    Get Auth Token
                </button>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Console Logs</h2>
            <div id="consoleLogs" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-sm max-h-64 overflow-y-auto">
                <div>Waiting for logs...</div>
            </div>
        </div>
    </div>

    <!-- Clerk SDK -->
    <script async crossorigin="anonymous" data-clerk-publishable-key="pk_test_ZXhjaXRlZC1ob3VuZC02NC5jbGVyay5hY2NvdW50cy5kZXYk" src="https://excited-hound-64.clerk.accounts.dev/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"></script>
    
    <!-- App Configuration -->
    <script src="/js/config.js"></script>
    <script src="/js/clerkClient.js"></script>

    <script>
        const logs = [];
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        // Capture console logs
        console.log = function(...args) {
            logs.push({ type: 'log', message: args.join(' '), time: new Date().toLocaleTimeString() });
            updateConsoleLogs();
            originalLog.apply(console, args);
        };

        console.error = function(...args) {
            logs.push({ type: 'error', message: args.join(' '), time: new Date().toLocaleTimeString() });
            updateConsoleLogs();
            originalError.apply(console, args);
        };

        console.warn = function(...args) {
            logs.push({ type: 'warn', message: args.join(' '), time: new Date().toLocaleTimeString() });
            updateConsoleLogs();
            originalWarn.apply(console, args);
        };

        function updateConsoleLogs() {
            const container = document.getElementById('consoleLogs');
            container.innerHTML = logs.slice(-20).map(log => 
                `<div class="mb-1">
                    <span class="text-gray-500">[${log.time}]</span>
                    <span class="text-${log.type === 'error' ? 'red' : log.type === 'warn' ? 'yellow' : 'green'}-400">
                        ${log.type.toUpperCase()}:
                    </span>
                    <span>${log.message}</span>
                </div>`
            ).join('');
            container.scrollTop = container.scrollHeight;
        }

        function updateAuthStatus() {
            const container = document.getElementById('authStatus');
            
            try {
                if (window.clerkAuth) {
                    const isAuth = window.clerkAuth.isAuthenticated();
                    const user = window.clerkAuth.getCurrentUser();
                    
                    container.innerHTML = `
                        <div class="py-1">Authentication: ${isAuth ? '‚úÖ Authenticated' : '‚ùå Not authenticated'}</div>
                        <div class="py-1">User ID: ${user?.id || 'None'}</div>
                        <div class="py-1">Email: ${user?.emailAddresses?.[0]?.emailAddress || 'None'}</div>
                        <div class="py-1">Name: ${user?.fullName || 'None'}</div>
                    `;
                } else {
                    container.innerHTML = '<div class="py-1 text-red-500">‚ùå ClerkAuth not available</div>';
                }
            } catch (error) {
                container.innerHTML = `<div class="py-1 text-red-500">‚ùå Error: ${error.message}</div>`;
            }
        }

        function updateClerkDetails() {
            const container = document.getElementById('clerkDetails');
            
            try {
                if (window.Clerk) {
                    container.innerHTML = `
                        <div class="py-1">Clerk Instance: ‚úÖ Available</div>
                        <div class="py-1">Loaded: ${window.Clerk.loaded ? '‚úÖ Yes' : '‚ùå No'}</div>
                        <div class="py-1">User: ${window.Clerk.user ? '‚úÖ Available' : '‚ùå None'}</div>
                        <div class="py-1">User ID: ${window.Clerk.user?.id || 'None'}</div>
                        <div class="py-1">Session: ${window.Clerk.session ? '‚úÖ Available' : '‚ùå None'}</div>
                        <div class="py-1">Version: ${window.Clerk.version || 'Unknown'}</div>
                    `;
                } else {
                    container.innerHTML = '<div class="py-1 text-red-500">‚ùå Clerk instance not available</div>';
                }
            } catch (error) {
                container.innerHTML = `<div class="py-1 text-red-500">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Update status every second
        setInterval(() => {
            updateAuthStatus();
            updateClerkDetails();
        }, 1000);

        // Button handlers
        document.getElementById('checkAuth').addEventListener('click', () => {
            console.log('üß™ Checking authentication...');
            try {
                if (window.clerkAuth) {
                    const isAuth = window.clerkAuth.isAuthenticated();
                    console.log(`üîç Authentication result: ${isAuth}`);
                } else {
                    console.error('‚ùå ClerkAuth not available');
                }
            } catch (error) {
                console.error('‚ùå Error checking auth:', error);
            }
        });

        document.getElementById('getUser').addEventListener('click', () => {
            console.log('üß™ Getting current user...');
            try {
                if (window.clerkAuth) {
                    const user = window.clerkAuth.getCurrentUser();
                    console.log('üë§ Current user:', user);
                } else {
                    console.error('‚ùå ClerkAuth not available');
                }
            } catch (error) {
                console.error('‚ùå Error getting user:', error);
            }
        });

        document.getElementById('getToken').addEventListener('click', async () => {
            console.log('üß™ Getting auth token...');
            try {
                if (window.clerkAuth) {
                    const token = await window.clerkAuth.getAuthToken();
                    console.log('üîë Auth token:', token ? 'Available' : 'None');
                } else {
                    console.error('‚ùå ClerkAuth not available');
                }
            } catch (error) {
                console.error('‚ùå Error getting token:', error);
            }
        });

        console.log('üöÄ Auth test tool loaded');
    </script>
</body>
</html>

